<script>
// This 404.html file handles dynamic API routes for GitHub Pages
// Routes like /api/reviews/1 will be handled here

(async function() {
    const path = window.location.pathname;
    const pathParts = path.split('/').filter(p => p);
    
    // Handle /api/reviews/:id
    if (pathParts.length >= 3 && pathParts[0] === 'api' && pathParts[1] === 'reviews') {
        const id = parseInt(pathParts[2]);
        
        if (isNaN(id)) {
            document.write('<pre>' + JSON.stringify({
                error: true,
                status: 400,
                message: 'Invalid review ID'
            }, null, 2) + '</pre>');
            return;
        }
        
        try {
            // Get the base URL and construct path to reviews.json
            const currentPath = window.location.pathname;
            const basePath = currentPath.replace(/\/api\/reviews\/.*$/, '');
            const reviewsPath = basePath + (basePath.endsWith('/') ? '' : '/') + 'reviews.json';
            
            const response = await fetch(reviewsPath);
            
            if (!response.ok) {
                throw new Error(`Failed to fetch reviews.json from ${reviewsPath}: ${response.status} ${response.statusText}`);
            }
            
            const data = await response.json();
            
            if (!data || !data.reviews || !Array.isArray(data.reviews)) {
                throw new Error('Invalid data format: reviews array not found');
            }
            
            const review = data.reviews.find(r => r.id === id);
            
            if (!review) {
                document.write('<pre>' + JSON.stringify({
                    error: true,
                    status: 404,
                    message: `Review with ID ${id} not found`
                }, null, 2) + '</pre>');
                return;
            }
            
            document.write('<pre>' + JSON.stringify({
                success: true,
                status: 200,
                data: review
            }, null, 2) + '</pre>');
            
        } catch (error) {
            document.write('<pre>' + JSON.stringify({
                error: true,
                status: 500,
                message: error.message
            }, null, 2) + '</pre>');
        }
        return;
    }
    
    // Default 404 response
    document.write('<pre>' + JSON.stringify({
        error: true,
        status: 404,
        message: 'Endpoint not found',
        path: path,
        availableEndpoints: [
            '/api/reviews.html',
            '/api/reviews/:id',
            '/api/stats.html',
            '/api/products.html'
        ]
    }, null, 2) + '</pre>');
})();
</script>

